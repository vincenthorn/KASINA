Here are clear instructions for your **Replit AI Agent**, outlining the **new direction** for music playback and analysis in the KASINA applicationâ€”along with the reasoning behind the shift from Spotify:

---

### ðŸ§  CONTEXT & REASON FOR SHIFT

We are **discontinuing use of the Spotify API** for audio analysis in KASINA due to a hard limitation:

> **Spotify deprecated access to the Audio Features and Audio Analysis APIs for all apps that did not receive extended quota access prior to November 27, 2024.**
> Attempts to access these endpoints from newer client IDs now result in **403 Forbidden errors**, and Spotify is no longer approving quota extensions for individual developers.

As a result, we are pivoting to a **fully client-side, user-uploaded `.mp3` file system** with in-browser audio analysis using the **Web Audio API**, which:

* Enables audio-reactive visualizations for the kasina orb
* Requires no API keys or rate-limited services
* Keeps all audio processing local and privacy-respecting
* Works fully within Replitâ€™s hosting capabilities

---

### âœ… NEW DIRECTION: MP3 Upload + Web Audio API

**Your task is to implement a working upload-and-visualize flow** based on user-provided `.mp3` files, using the Web Audio API for analysis.

#### ðŸ‘‡ Key Features to Build

1. **MP3 Upload UI**

   * HTML `<input type="file" accept="audio/mpeg">`
   * Client-side validation to restrict to `.mp3`

2. **AudioContext Setup**

   * Decode uploaded MP3 using `AudioContext.decodeAudioData`
   * Create `AudioBufferSourceNode` for playback

3. **Audio Analysis Nodes**

   * Create and connect an `AnalyserNode`
   * Use `.getByteFrequencyData()` and/or `.getByteTimeDomainData()`

4. **Visualizer Hook**

   * Create an animation loop that:

     * Retrieves amplitude / frequency data in real time
     * Sends it to a provided `updateOrbVisual(volume)` function
   * Bonus: compute and display session stats (e.g., avg volume)

5. **Orb Visual Sync**

   * Link amplitude/frequency data to orb parameters (glow, size, hue, etc.)
   * Ensure smooth transitions and frame-rate-friendly updates

6. **Fallback Track (Optional)**

   * Provide a default demo `.mp3` for users who donâ€™t upload one
   * This can be hosted locally or via CDN

---

### ðŸ§© Tech Stack Constraints

* Must work **client-side only** (Replit frontend)
* Do **not rely on Spotify, YouTube, or third-party APIs**
* Optimize for **low-latency, real-time responsiveness**

---

### ðŸ“¦ Optional Enhancements

* Looping playback
* Toggle waveform vs frequency visualization
* Downloadable session summary with analysis stats

---

Let me know if you'd like me to write out the initial JS/HTML scaffold or provide a React-compatible version.
